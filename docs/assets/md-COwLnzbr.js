import{_ as p,I as d}from"./slidev/two-cols-header-nGZfANre.js";import{b as g,o,w as l,g as i,B as s,e as h,m as k,v as y,x as F,C as e}from"./modules/vue-CN_MgJgD.js";import{u as c,f as u}from"./slidev/context-CSRnI4z7.js";import"./modules/unplugin-icons-CK6QWdxd.js";import"./index-D7hQM0az.js";import"./modules/shiki-CbJNJzfY.js";const E={__name:"thread_local.md__slidev_19",setup(C){const{$clicksContext:n,$frontmatter:D}=c();return n.setup(),(m,a)=>{const t=p;return o(),g(d,y(F(e(u)(e(D),18))),{left:l(r=>[h(t,k({},{ranges:[]}),{default:l(()=>a[0]||(a[0]=[i("pre",{class:"shiki shiki-themes dark-plus light-plus slidev-code",style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000","--shiki-dark-bg":"#1E1E1E","--shiki-light-bg":"#FFFFFF"}},[i("code",{class:"language-cpp"},[i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"int"),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}}," getInitValue"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"();")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"const"),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}}," int"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," InvalidValue = "),i("span",{style:{"--shiki-dark":"#B5CEA8","--shiki-light":"#098658"}},"0"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"__attribute(("),i("span",{style:{"--shiki-dark":"#4EC9B0","--shiki-light":"#267F99"}},"tls_model"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"("),i("span",{style:{"--shiki-dark":"#CE9178","--shiki-light":"#A31515"}},'"initial-exec"'),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"))) ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"thread_local"),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}}," int"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," value_tl = InvalidValue;")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"int"),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}}," getValueTLCustomInit"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"(){")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#C586C0","--shiki-light":"#AF00DB"}},"  if"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," (value_tl == InvalidValue) { ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"    value_tl = "),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}},"getInitValue"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"(); ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"  }")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#C586C0","--shiki-light":"#AF00DB"}},"  return"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," value_tl;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"}")])])],-1)])),_:1},16)]),right:l(r=>[h(t,k({},{ranges:[]}),{default:l(()=>a[1]||(a[1]=[i("pre",{class:"shiki shiki-themes dark-plus light-plus slidev-code",style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000","--shiki-dark-bg":"#1E1E1E","--shiki-light-bg":"#FFFFFF"}},[i("code",{class:"language-asm"},[i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"getValueTLCustomInit():")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        mov     "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"rbx"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},", "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"QWORD"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," PTR value_tl@gottpoff["),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"rip"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"]"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}}," # load offset")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        mov     "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"eax"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},", "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"DWORD"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," PTR "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"fs"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},":["),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"rbx"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"]              "),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}}," # load value")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        test    "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"eax"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},", "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"eax"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},"                              # check if it's 0")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        je      .CallInitFunc                        "),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}}," # call init if it's 0")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        ret")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"."),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}},"CallInitFunc:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        call    ["),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"QWORD"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," PTR getInitValue()@GOTPCREL["),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"rip"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"]]")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        mov     "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"DWORD"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," PTR "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"fs"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},":["),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"rbx"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"], "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"eax")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        ret")])])],-1)])),_:1},16)]),default:l(()=>[a[2]||(a[2]=i("h1",null,"Shared Object : performance workarounds",-1)),a[3]||(a[3]=i("h3",null,[s("WA-3.1 if "),i("code",null,"'initial-exec'"),s(" variable requires dynamic initialization - use a custom one")],-1)),a[4]||(a[4]=i("p",null,[s("Dynamic initialization in this case might call "),i("code",null,"_tls_get_addr"),s(" to check initialization guard that affects performance."),i("br"),s(" If the variable has an invalid state - then the implementation is trivial."),i("br"),s(" if not - add a variable for this purpose: "),i("code",null,"thread_local bool isInitialized = false;"),s(".")],-1))]),_:1},16)}}};export{E as default};
