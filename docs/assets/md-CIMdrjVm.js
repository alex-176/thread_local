import{_ as d,I as D}from"./slidev/two-cols-header-nGZfANre.js";import{b as g,o,w as l,g as i,B as s,e as h,m as k,v as y,x as c,C as n}from"./modules/vue-CN_MgJgD.js";import{u as C,f as F}from"./slidev/context-CSRnI4z7.js";import"./modules/unplugin-icons-CK6QWdxd.js";import"./index-D7hQM0az.js";import"./modules/shiki-CbJNJzfY.js";const A={class:"relative w-full"},x={__name:"thread_local.md__slidev_11",setup(f){const{$clicksContext:e,$frontmatter:p}=C();return e.setup(),(u,a)=>{const t=d;return o(),g(D,y(c(n(F)(n(p),10))),{left:l(r=>[h(t,k({},{ranges:[]}),{default:l(()=>a[0]||(a[0]=[i("pre",{class:"shiki shiki-themes dark-plus light-plus slidev-code",style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000","--shiki-dark-bg":"#1E1E1E","--shiki-light-bg":"#FFFFFF"}},[i("code",{class:"language-cpp"},[i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"int"),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}}," getpid"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"int"),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}}," gettid"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"();")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},"// 2 thread_local variables with non trivial init")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"thread_local"),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}}," int"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," tid = "),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}},"gettid"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"();")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"thread_local"),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}}," int"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," pid = "),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}},"getpid"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"();")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},"// pretend we use a variable ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"void"),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}}," print"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"("),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"int"),i("span",{style:{"--shiki-dark":"#9CDCFE","--shiki-light":"#001080"}}," v"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},");")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},"// a function that uses tid")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"void"),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}}," f"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"(){")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}},"    print"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"(tid);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"}")])])],-1)])),_:1},16)]),right:l(r=>[i("div",A,[h(t,k({},{ranges:[]}),{default:l(()=>a[1]||(a[1]=[i("pre",{class:"shiki shiki-themes dark-plus light-plus slidev-code",style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000","--shiki-dark-bg":"#1E1E1E","--shiki-light-bg":"#FFFFFF"}},[i("code",{class:"language-asm"},[i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"f():")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        cmp     "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"BYTE"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," PTR "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"fs"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},":__tls_guard@tpoff, "),i("span",{style:{"--shiki-dark":"#B5CEA8","--shiki-light":"#098658"}},"0"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}}," # Is TLS initialized")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        je      .TLS_Init                  "),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}}," # jmp to TLS Initialization")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"."),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}},"Continue:"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        mov     "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"edi"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},", "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"DWORD"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," PTR "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"fs"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},":tid@tpoff"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}}," # read tid")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        jmp     print(int)                 "),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}}," # call print(tid)")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"."),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}},"TLS_Init:"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},"                                  # TLS initialization")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        mov     "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"BYTE"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," PTR "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"fs"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},":__tls_guard@tpoff, "),i("span",{style:{"--shiki-dark":"#B5CEA8","--shiki-light":"#098658"}},"1"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},' # mark TLS "initialized"')]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        call    gettid()                    ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        mov     "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"DWORD"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," PTR "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"fs"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},":tid@tpoff, "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"eax"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}}," # init tid with gettid()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        call    getpid()                    ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        mov     "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"DWORD"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}}," PTR "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"fs"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},":pid@tpoff, "),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"eax"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}}," # init pid with getpid()  ")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        jmp     .Continue")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}},"__tls_guard:"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},"            # Thread Local Storage section")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        .zero   "),i("span",{style:{"--shiki-dark":"#B5CEA8","--shiki-light":"#098658"}},"1"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},"       # TLS guard - checks if the section initialized")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}},"pid:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        .zero   "),i("span",{style:{"--shiki-dark":"#B5CEA8","--shiki-light":"#098658"}},"4"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},"       # thread_local pid")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}},"tid:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"        .zero   "),i("span",{style:{"--shiki-dark":"#B5CEA8","--shiki-light":"#098658"}},"4"),i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},"       # thread_local tid")])])],-1)])),_:1},16),a[2]||(a[2]=i("div",{class:"absolute top-[0] left-[0] z-[1000] pointer-events-none"},[i("svg",{width:"800",height:"500"},[i("rect",{x:"0",y:"243",width:"530",height:"110",stroke:"red","stroke-width":"1",fill:"none"}),i("text",{x:"450",y:"350",fill:"#B65757","font-size":"4"}," tls section ")])],-1))])]),default:l(()=>[a[3]||(a[3]=i("h1",null,"Class lifetime : Construction (gcc/clang specific)",-1)),a[4]||(a[4]=i("h4",null,"gcc/clang are using one boolean guard for all thread_local variables",-1)),a[5]||(a[5]=i("h4",null,[s("Implications: if one "),i("code",null,"thread_local"),s(" is accessed - all "),i("code",null,"thread_local"),s(" of this thread are initialized.")],-1))]),_:1},16)}}};export{x as default};
